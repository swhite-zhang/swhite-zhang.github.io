<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>OS 线程 | Ascrush</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="线程">
<meta property="og:type" content="article">
<meta property="og:title" content="OS 线程">
<meta property="og:url" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="Ascrush">
<meta property="og:description" content="线程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B4.jpg">
<meta property="og:image" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B.jpg">
<meta property="og:image" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B1.jpg">
<meta property="og:image" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B2.jpg">
<meta property="og:image" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B3.jpg">
<meta property="article:published_time" content="2020-01-07T18:26:03.355Z">
<meta property="article:modified_time" content="2020-01-07T16:14:52.757Z">
<meta property="article:author" content="Ascrush">
<meta property="article:tag" content="OS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B4.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Ascrush" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Ascrush</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.ascrush.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-os线程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/08/os%E7%BA%BF%E7%A8%8B/" class="article-date">
  <time datetime="2020-01-07T18:26:03.355Z" itemprop="datePublished">2020-01-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      OS 线程
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h1><a id="more"></a>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>线程是CPU使用的基本单元，它由线程ID、程序计数器、寄存器集合和栈组成。它与同属一个进程的其他线程共享代码段、数据段和其他操作系统资源。<br><img src="/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B4.jpg" alt="单线程和多线程的区别" title="多线程和单线程的区别"></p>
<h3 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h3><p>有时候，一个应用程序可能需要执行多个相似的任务。</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>1.响应度高</li>
<li>2.资源共享：线程默认共享它们所属进程的内存和资源。</li>
<li>3.经济：进程创建所需要的内存和资源的分配比较昂贵。</li>
<li>4.多处理器体系结构的利用：充分使用多处理器体系结构。<h2 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h2>两种方法：<blockquote>
<ul>
<li>用户层的用户线程：受内核支持，而无需内核管理。</li>
<li>内核层的内核线程：由操作系统直接支持和管理。</li>
</ul>
</blockquote>
<h3 id="多对一模型"><a href="#多对一模型" class="headerlink" title="多对一模型"></a>多对一模型</h3>将许多用户线程映射到一个内核线程。例如Green thread和<strong>GNU可移植线程（GNU Portable Thread）</strong>。效率比较高，但因为任一时刻只有一个线程能访问内核，多个线程不能并行运行在多处理器上。</li>
</ul>
<p><img src="/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B.jpg" alt="多对一模型" title="多对一模型"></p>
<h3 id="一对一模型"><a href="#一对一模型" class="headerlink" title="一对一模型"></a>一对一模型</h3><p>每个用户线程映射到一个内核线程。例如Linux和Windows操作系统家族。能够很好的实现并发功能，但因为创建内核线程的开销会影响应用程序的性能，所以会限制系统所支持的线程的数量。</p>
<p><img src="/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B1.jpg" alt="一对一模型" title="一对一模型"></p>
<h3 id="多对多模型"><a href="#多对多模型" class="headerlink" title="多对多模型"></a>多对多模型</h3><p>复用了许多用户线程到同样数量或更小的内核线程上。没有增加并发性，但不用担心线程过多且能并发执行。</p>
<p><img src="/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B2.jpg" alt="多对多模型" title="多对多模型"></p>
<h2 id="线程库（thread-library）"><a href="#线程库（thread-library）" class="headerlink" title="线程库（thread library）"></a>线程库（thread library）</h2><p>提供创建和管理线程的API。</p>
<p>实现线程库的两种方法：</p>
<blockquote>
<ul>
<li>在用户空间中提供一个没有内核支持的库，调用函数只是一个本地函数调用而不是系统调用。</li>
<li>执行一个由操作系统直接支持的内核级库，调用一个API通常会导致对内核的系统调用。</li>
</ul>
</blockquote>
<p>当前使用的三种主要的线程库：1.Pthread、2.Win32、3.Java。</p>
<h2 id="多线程问题"><a href="#多线程问题" class="headerlink" title="多线程问题"></a>多线程问题</h2><h3 id="系统调用fork-和exec"><a href="#系统调用fork-和exec" class="headerlink" title="系统调用fork()和exec()"></a>系统调用fork()和exec()</h3><h3 id="取消"><a href="#取消" class="headerlink" title="取消"></a>取消</h3><p><strong>线程取消（thread cancellation）</strong>，在线程完成之前来终止线程的任务。要取消的线程通常称为目标线程。</p>
<blockquote>
<ul>
<li>1.异步取消（asynchronous cancellation）：一个线程立即终止目标线程。</li>
<li>2.延迟取消（deferred cancellation）：目标线程不断地检查它是否应终止，这允许目标线程有机会以有序方式来终结自己。</li>
</ul>
</blockquote>
<h3 id="信号处理"><a href="#信号处理" class="headerlink" title="信号处理"></a>信号处理</h3><p>所有信号具有同样的模式</p>
<blockquote>
<ul>
<li>1.信号是由特事件的发生所产生的</li>
<li>2.产生信号要发送到线程</li>
<li>3一旦发送，信号必须加以处理</li>
</ul>
</blockquote>
<p>每个信号可能由两种可能的处理程序的一种来处理：</p>
<blockquote>
<p>1.<strong>默认信号处理程序（default signal handler）</strong>，每个程序都有一个默认信号处理程序<br>2.用户定义的信号处理程</p>
</blockquote>
<h3 id="线程池（thread-pool）"><a href="#线程池（thread-pool）" class="headerlink" title="线程池（thread pool）"></a>线程池（thread pool）</h3><p>优点：</p>
<blockquote>
<ul>
<li>通常用现有线程处理请求要比等待创建新的线程块</li>
<li>线程池限制了在任何时候可用线程的数量（由系统CPU的数量、物理内存的大小和并发客户请求的期望值等确定）</li>
</ul>
</blockquote>
<h3 id="线程特定数据（thread-specific-data）"><a href="#线程特定数据（thread-specific-data）" class="headerlink" title="线程特定数据（thread-specific data）"></a>线程特定数据（thread-specific data）</h3><p>同属一个进程的线程共享进程数据。不过一些线程在某些情况下需要一定数据的自己的副本。这些就称为线程特定数据。</p>
<h3 id="调度程序激活（scheduler-activation）"><a href="#调度程序激活（scheduler-activation）" class="headerlink" title="调度程序激活（scheduler activation）"></a>调度程序激活（scheduler activation）</h3><p>一种解决用户线程库与内核间通信的方法。内核提供一组虚拟处理器（轻量级进程，LWP）给应用程序，应用程序可调度用户线程到一个可用的LWP上。这样就为线程提供了一个用户级的中间系统，它就可以通过系统调用获得内核提供的服务。</p>
<p><img src="/2020/01/08/os%E7%BA%BF%E7%A8%8B/os%E7%BA%BF%E7%A8%8B3.jpg" alt="轻量级进程（LWP）" title="轻量级进程（LWP）"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.ascrush.cn/2020/01/08/os%E7%BA%BF%E7%A8%8B/" data-id="ck5f0ogi3000mc4w864mb9s9k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/01/08/os%E8%BF%9B%E7%A8%8B/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          OS 进程
        
      </div>
    </a>
  
  
    <a href="/2020/01/08/os%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">OS 操作系统结构</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
<div class="widget-wrap">
    <h3 class="widget-title">About</h3>
    <div class="widget">
        邮箱：zzzhhh@bupt.edu.cn<br />
        github：<a href="https://github.com/swhite-zhang" target="_blank">swhite-zhang</a>
        <br />
    </div>
</div>

  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2019/" rel="tag">2019</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%84%E5%BD%B1/" rel="tag">摄影</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/2019/" style="font-size: 10px;">2019</a> <a href="/tags/OS/" style="font-size: 20px;">OS</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 10px;">摄影</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/09/2019%E6%91%84%E5%BD%B1%E8%AE%B0%E5%BD%95/">2019摄影记录</a>
          </li>
        
          <li>
            <a href="/2020/01/08/os%E8%BF%9B%E7%A8%8B/">OS 进程</a>
          </li>
        
          <li>
            <a href="/2020/01/08/os%E7%BA%BF%E7%A8%8B/">OS 线程</a>
          </li>
        
          <li>
            <a href="/2020/01/08/os%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/">OS 操作系统结构</a>
          </li>
        
          <li>
            <a href="/2020/01/08/os%E5%AF%BC%E8%AE%BA/">OS 导论</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Ascrush<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
  <div id="top">
    <a href="#">▲</a>
    <a href="#footer">▼</a>
</div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>